<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Creature.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">demo</a> &gt; <a href="index.source.html" class="el_package">game.com.example.world</a> &gt; <span class="el_source">Creature.java</span></div><h1>Creature.java</h1><pre class="source lang-java linenums">package game.com.example.world;

import java.awt.Color;
import java.lang.Thread;
import java.security.PublicKey;
import java.util.Random;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

public class Creature extends Thread{

<span class="fc" id="L12">    enum creatureType</span>
    {
<span class="fc" id="L14">        PLAYER,</span>
<span class="fc" id="L15">        FUNGUS,</span>
    }
    private World world;

    private int x;

    public void setX(int x) {
<span class="fc" id="L22">        this.x = x;</span>
<span class="fc" id="L23">    }</span>

    public int x() {
<span class="fc" id="L26">        return x;</span>
    }

    private int y;

    public void setY(int y) {
<span class="fc" id="L32">        this.y = y;</span>
<span class="fc" id="L33">    }</span>

    public int y() {
<span class="fc" id="L36">        return y;</span>
    }

    private char glyph;

    public char glyph() {
<span class="nc" id="L42">        return this.glyph;</span>
    }

    private Color color;

    public Color color() {
<span class="nc" id="L48">        return this.color;</span>
    }

    private CreatureAI ai;

    public void setAI(CreatureAI ai) {
<span class="fc" id="L54">        this.ai = ai;</span>
<span class="fc" id="L55">    }</span>

    private int maxHP;

    public int maxHP() {
<span class="nc" id="L60">        return this.maxHP;</span>
    }

    private int hp;

    public int hp() {
<span class="fc" id="L66">        return this.hp;</span>
    }

    public synchronized void modifyHP(int amount) {
<span class="fc" id="L70">        this.hp += amount;</span>
<span class="fc bfc" id="L71" title="All 2 branches covered.">        if(this.hp&gt;100)</span>
<span class="fc" id="L72">            hp=100;</span>
<span class="fc bfc" id="L73" title="All 2 branches covered.">        if (this.hp &lt; 1) {</span>
<span class="fc" id="L74">            world.remove(this);</span>
<span class="pc bpc" id="L75" title="1 of 2 branches missed.">            if(this.type==creatureType.PLAYER)</span>
            {
<span class="nc" id="L77">                this.world.playerSize--;</span>
            }
<span class="pc bpc" id="L79" title="1 of 2 branches missed.">            else if(this.type==creatureType.FUNGUS)</span>
            {
<span class="fc" id="L81">                this.world.FungSize--;</span>
            }
        }
<span class="fc" id="L84">    }</span>

    private int attackValue;

    public int attackValue() {
<span class="fc" id="L89">        return this.attackValue;</span>
    }

    private int defenseValue;

    public int defenseValue() {
<span class="fc" id="L95">        return this.defenseValue;</span>
    }

    private int visionRadius;

    public int visionRadius() {
<span class="nc" id="L101">        return this.visionRadius;</span>
    }

    public boolean canSee(int wx, int wy) {
<span class="nc" id="L105">        return ai.canSee(wx, wy);</span>
    }

    public Tile tile(int wx, int wy) {
<span class="nc" id="L109">        return world.tile(wx, wy);</span>
    }

    public void dig(int wx, int wy) {
<span class="fc" id="L113">        world.dig(wx, wy);</span>
<span class="fc" id="L114">    }</span>

    public synchronized void moveBy(int mx, int my) {
<span class="pc bpc" id="L117" title="1 of 2 branches missed.">        if(this.hp&lt;=0)</span>
        {
<span class="nc" id="L119">            return;</span>
        }
<span class="pc bpc" id="L121" title="3 of 8 branches missed.">        if(x+mx&lt;0 || x+mx &gt;29 || y+my&lt;0 || y+my &gt;29)</span>
        {   
<span class="fc" id="L123">            Creature other = world.creature(x, y);</span>
<span class="pc bpc" id="L124" title="1 of 2 branches missed.">            if (other == null) {</span>
<span class="nc" id="L125">                ai.onEnter(x, y, world.tile(x, y));</span>
            } else {
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">                if(this.type!=other.type)</span>
                {
<span class="nc" id="L129">                    attack(other);</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">                    if(other.hp()&gt;0)</span>
<span class="nc" id="L131">                        other.attack(this);</span>
                }
                    
            }
<span class="fc" id="L135">            return ;</span>
        }
<span class="fc" id="L137">        Creature other = world.creature(x + mx, y + my);</span>
<span class="pc bpc" id="L138" title="1 of 2 branches missed.">        if (other == null) {</span>
<span class="fc" id="L139">            ai.onEnter(x + mx, y + my, world.tile(x + mx, y + my));</span>
        } else {
<span class="nc bnc" id="L141" title="All 2 branches missed.">            if(this.type!=other.type)</span>
            {
<span class="nc" id="L143">                attack(other);</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">                if(other.hp()&gt;0)</span>
<span class="nc" id="L145">                    other.attack(this);</span>
            }
        }
<span class="fc" id="L148">    }</span>

    public synchronized void attack(Creature other) {
<span class="nc" id="L151">        int damage = Math.max(0, this.attackValue() - other.defenseValue());</span>
<span class="nc" id="L152">        damage = (int) (Math.random() * damage) + 1;</span>
<span class="nc" id="L153">        LocalDateTime currentDateTime = LocalDateTime.now();</span>
<span class="nc" id="L154">        DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss.SSS&quot;);</span>
<span class="nc" id="L155">        String formattedDateTime = currentDateTime.format(formatter);</span>
<span class="nc" id="L156">        System.out.println(this + &quot;attack&quot;+ x +&quot; &quot;+y + &quot;at&quot; +formattedDateTime + &quot; with&quot; + damage);</span>
<span class="nc" id="L157">        other.modifyHP(-damage);</span>
<span class="nc" id="L158">        this.notify(&quot;You attack the '%s' for %d damage.&quot;, other.glyph, damage);</span>
<span class="nc" id="L159">        other.notify(&quot;The '%s' attacks you for %d damage.&quot;, glyph, damage);</span>
<span class="nc" id="L160">    }</span>

    public void update() {
<span class="nc" id="L163">        this.ai.onUpdate();</span>
<span class="nc" id="L164">    }</span>

    public synchronized boolean canEnter(int x, int y) {
<span class="nc" id="L167">        return world.tile(x, y).isGround();</span>
    }

    public void notify(String message, Object... params) {
<span class="nc" id="L171">        ai.onNotify(String.format(message, params));</span>
<span class="nc" id="L172">    }</span>

    public creatureType type;
<span class="fc" id="L175">    public Creature(creatureType type,World world, char glyph, Color color, int maxHP, int attack, int defense, int visionRadius) {</span>
<span class="fc" id="L176">        this.world = world;</span>
<span class="fc" id="L177">        this.glyph = glyph;</span>
<span class="fc" id="L178">        this.color = color;</span>
<span class="fc" id="L179">        this.maxHP = maxHP;</span>
<span class="fc" id="L180">        this.hp = maxHP;</span>
<span class="fc" id="L181">        this.attackValue = attack;</span>
<span class="fc" id="L182">        this.defenseValue = defense;</span>
<span class="fc" id="L183">        this.visionRadius = visionRadius;</span>
<span class="fc" id="L184">        this.type=type;</span>
<span class="fc" id="L185">    }</span>

    @Override
    public void run()
    {
<span class="pc bpc" id="L190" title="2 of 4 branches missed.">        while (this.world.FungSize&gt;0 &amp;&amp; this.hp&gt;0) {</span>
            try
            {
<span class="nc" id="L193">                Thread.sleep(1000);</span>
            }
<span class="nc" id="L195">            catch (InterruptedException e)</span>
            {
<span class="nc" id="L197">                e.printStackTrace();</span>
<span class="nc" id="L198">            }</span>
<span class="nc" id="L199">            this.ai.automove(this.x(),this.y());</span>
<span class="nc" id="L200">            this.yield();</span>
        }
<span class="nc" id="L202">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>